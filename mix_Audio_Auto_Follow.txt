'vMixのmixでAudio Followを実装するScriptです。
'final_output_keyにPGMに出力するmixをsourceに含んだInputのKeyを入力してください。keyは""で囲んで次のkeyを入れる場合は,で区切ってください。
'例：dim final_output_key As String = {"ff58e63c-b799-42cd-9910-ece6cdcd8954", "98094b69-89c1-4d8c-86e7-73145f818a96", "9db82233-2966-490b-a0a9-c13c58b88212"}
'mix_numberにmixの番号を入力してください。
'例：dim mix_number As String = "2"
'input_keysにInputのKeyを入力してください。keyは""で囲んで次のkeyを入れる場合は,で区切ってください。
'例：dim input_keys() As String = {"ff58e63c-b799-42cd-9910-ece6cdcd8954", "98094b69-89c1-4d8c-86e7-73145f818a96", "9db82233-2966-490b-a0a9-c13c58b88212"}


dim VmixXML as new system.xml.xmldocument

VmixXML.loadxml(API.XML)

'--------------ここを入力---------------
dim final_output_key() As String = {""}
dim mix_number As String = ""
dim input_keys() As String = {""}
'--------------------------------------

dim active_input As String = ""
dim mix_active_input As String = ""
dim input_state(input_keys.Length) As String

dim input_numbers(input_keys.Length) As String
dim final_output_number(final_output_key.Length) As String

For a As Integer = 0 To input_keys.Length-1
   input_state(a) = False
Next

dim input_numbers_1(input_keys.Length) As String
dim final_output_number_1(final_output_key.Length) As String

VmixXML.loadxml(API.XML)

For b As Integer = 0 To input_keys.Length -1

   input_numbers_1(b) = VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & input_keys(b) & """]").Attributes.GetNamedItem("number").Value

Next

For c As Integer = 0 To final_output_key.Length -1

   final_output_number_1(c) = VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & final_output_key(c) & """]").Attributes.GetNamedItem("number").Value

Next

active_input = VmixXML.selectSingleNode("/vmix/active").InnerText
mix_active_input = VmixXML.selectSingleNode("/vmix/mix[@number=""" & mix_number & """]/active").InnerText

For d As integer = 0 To input_keys.Length
   If input_numbers_1(d) = active_input Then
      input_state(d) = True
   End If
Next


For e As integer = 0 To final_output_key.Length -1
   If final_output_number_1(e) = active_input Then
      For i As Integer = 0 To input_keys.Length - 1
         If input_numbers_1(e) = mix_active_input Then
            input_state(e) = True
         End If
      Next
   End If
Next

For f As integer = 0 To input_keys.Length - 1
   If input_state(f) = True
      If VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & input_keys(f) & """]").Attributes.GetNamedItem("muted").Value = "True" Then

         API.Function("Audioon", input_keys(f))
         'Console.WriteLine("Audio On : " & input_keys(f))
         
      End If
   Else
      If VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & input_keys(f) & """]").Attributes.GetNamedItem("muted").Value = "False" Then

         API.Function("AudioOff", input_keys(f))
         'Console.WriteLine("Audio Off : " & input_keys(f))
            
      End If
   End If
Next


While(True)

   VmixXML.loadxml(API.XML)

   For g As Integer = 0 To input_keys.Length-1
      input_state(g) = False
   Next

   For h As Integer = 0 To input_keys.Length -1

      input_numbers(h) = VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & input_keys(h) & """]").Attributes.GetNamedItem("number").Value

   Next

   For i As Integer = 0 To final_output_key.Length -1

      final_output_number(i) = VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & final_output_key(i) & """]").Attributes.GetNamedItem("number").Value

   Next

   active_input = VmixXML.selectSingleNode("/vmix/active").InnerText
   mix_active_input = VmixXML.selectSingleNode("/vmix/mix[@number=""" & mix_number & """]/active").InnerText
   
   For j As integer = 0 To input_keys.Length
      If input_numbers(j) = active_input Then
         input_state(j) = True
      End If
   Next

   For k As integer = 0 To final_output_key.Length -1
      If final_output_number(k) = active_input Then
         For i As Integer = 0 To input_keys.Length - 1
            If input_numbers(k) = mix_active_input Then
               input_state(k) = True
            End If
         Next
      End If
   Next

   For m As integer = 0 To input_keys.Length - 1
      If input_state(l) = True
         If VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & input_keys(m) & """]").Attributes.GetNamedItem("muted").Value = "True" Then

            API.Function("Audioon", input_keys(m))
            'Console.WriteLine("Audio On : " & input_keys(m))
            
         End If
      Else
         If VmixXML.selectSingleNode("/vmix/inputs/input[@key=""" & input_keys(m) & """]").Attributes.GetNamedItem("muted").Value = "False" Then

            API.Function("AudioOff", input_keys(m))
            'Console.WriteLine("Audio Off : " & input_keys(m))
               
         End If
      End If
   Next

End While